<script lang="ts">
	import type { PageData } from './$types';
	import { storeClient } from '$trpc/browserClients';

	export let data: PageData;

	let list = storeClient.db.addToList.mutate.$multiple({
		prefill: data.prefill,
		loading: true,
		unique: function (input, response) {
			return input ? input : response;
		}
	});

	let itemInput: HTMLInputElement;
	function addItem() {
		$list.call(itemInput.value);
		itemInput.value = '';
	}
</script>

{#if $list.loading}
	<span style="font-weight:bold;font-size:1.2rem">Adding an item... </span><br />
{/if}

{#each $list.responses as response}
	{#if response.loading}
		Adding item...
	{:else if response.success}
		{response.data}
	{:else if response.error}
		{response.error.message}
	{/if}
	<br />
{/each}

<form on:submit|preventDefault={addItem}>
	<input placeholder="Item" bind:this={itemInput} />
</form>
